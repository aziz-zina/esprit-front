<!-- ===================================== -->
<!-- src/app/modules/admin/example/example.component.html -->
<!-- ===================================== -->

<!-- Outer Fuse structure (Assume this exists above) -->
<div class="flex min-w-0 flex-auto flex-col">
    <div class="flex-auto p-6 sm:p-10">

        <!-- CONTENT GOES HERE -->
        <div class="grid grid-cols-1 gap-6 lg:grid-cols-3">

            <!-- Left Column: Repo Management, Git Controls, History & File Tree -->
            <div class="space-y-6 lg:col-span-1">

                <!-- Repository Management Section -->
                <div class="rounded-lg border border-gray-300 bg-gray-50 p-4 shadow-sm">
                    <h2 class="mb-4 text-xl font-semibold text-gray-800">Repository Management</h2>

                    <!-- Fetch Repos Button -->
                    <div class="mb-4">
                        <button type="button" (click)="fetchGithubRepos()" [disabled]="isFetchingRepos || !githubAccessToken || isBusy" class="btn-primary w-full disabled:opacity-50">
                            <span *ngIf="!isFetchingRepos">{{ githubAccessToken ? 'Fetch My GitHub Repos' : 'Get Token First' }}</span>
                            <span *ngIf="isFetchingRepos">Fetching Repos...</span>
                        </button>
                         <button *ngIf="!githubAccessToken" type="button" (click)="fetchGithubAccessToken()" [disabled]="isLoading" class="btn-secondary w-full mt-2 disabled:opacity-50">
                             <span *ngIf="!isLoading">Retry Get GitHub Token</span>
                             <span *ngIf="isLoading">Getting Token...</span>
                         </button>
                    </div>

                    <!-- Available GitHub Repos -->
                    <div *ngIf="isFetchingRepos" class="mb-4 border-t pt-4 text-sm text-gray-500">Loading GitHub repositories...</div>
                    <div *ngIf="!isFetchingRepos && githubRepoList && githubRepoList.length === 0" class="mb-4 border-t pt-4 text-sm text-gray-500">No repositories found on GitHub or error fetching.</div>

                    <div *ngIf="!isFetchingRepos && githubRepoList && githubRepoList.length > 0" class="mb-4 border-t pt-4">
                        <h3 class="mb-2 text-base font-semibold text-gray-700">Available on GitHub</h3>
                        <ul class="max-h-48 overflow-y-auto space-y-1 text-sm border rounded p-2 bg-white">
                            <li *ngFor="let repo of githubRepoList" class="flex items-center justify-between p-1 rounded hover:bg-gray-100">
                                <span class="truncate flex-grow mr-2" [title]="repo.full_name">
                                    {{ repo.full_name }}
                                    <span *ngIf="repo.private" class="ml-1 text-xs text-gray-500 bg-gray-200 px-1 rounded">(Private)</span>
                                </span>
                                <button type="button" (click)="addRepoToManaged(repo)" [disabled]="isRepoManaged(repo.id) || isBusy" class="btn-secondary btn-xs disabled:opacity-50 disabled:cursor-not-allowed flex-shrink-0">
                                    {{ isRepoManaged(repo.id) ? 'Managed' : 'Manage' }}
                                </button>
                            </li>
                        </ul>
                    </div>

                    <!-- Managed Repositories -->
                    <div class="border-t pt-4">
                         <h3 class="mb-2 text-base font-semibold text-gray-700">Managed Locally</h3>
                         <div *ngIf="managedRepositories.length === 0 && !activeRepository" class="text-sm text-gray-500">Add repositories from GitHub to manage them here.</div>
                         <div *ngIf="managedRepositories.length === 0 && activeRepository" class="text-sm text-gray-500">No repositories currently managed locally.</div>

                         <ul *ngIf="managedRepositories.length > 0" class="max-h-48 overflow-y-auto space-y-1 text-sm border rounded p-2 bg-white">
                            <li *ngFor="let managedRepo of managedRepositories"
                                class="flex items-center justify-between p-1 rounded cursor-pointer"
                                [class.bg-indigo-100]="activeRepository?.id === managedRepo.id"
                                [class.hover:bg-gray-100]="activeRepository?.id !== managedRepo.id"
                                (click)="setActiveRepository(managedRepo)"
                                [title]="'Activate ' + managedRepo.fullName">
                                <span class="truncate font-medium flex-grow mr-2" [class.text-indigo-700]="activeRepository?.id === managedRepo.id">
                                    {{ managedRepo.fullName }}
                                </span>
                                <button type="button" (click)="$event.stopPropagation(); removeManagedRepo(managedRepo)" [disabled]="isBusy" class="btn-secondary btn-xs text-red-600 hover:bg-red-50 disabled:opacity-50 flex-shrink-0">
                                    Remove
                                </button>
                            </li>
                         </ul>
                    </div>
                </div> <!-- End Repo Management Section -->


                <!-- Git Controls Section (Operates on Active Repo) -->
                <div class="rounded-lg border border-gray-300 bg-gray-50 p-4 shadow-sm">
                    <h2 class="mb-2 text-xl font-semibold text-gray-800">
                        Git Controls
                        <span *ngIf="activeRepository" class="text-base font-normal text-indigo-600">- {{ activeRepository.name }}</span>
                        <span *ngIf="isBusy" class="ml-2 text-sm text-blue-600 animate-pulse"> (Working...)</span>
                    </h2>                    <div *ngIf="!activeRepository" class="text-sm text-gray-500 mb-4">Select a managed repository to enable controls.</div>

                    <!-- Branch Selection for Clone -->
                    <div *ngIf="activeRepository && !cloneDone" class="mb-4 border rounded p-3 bg-white">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Select Branch to Clone:</label>
                        <div class="flex gap-2">
                            <button type="button" (click)="fetchRemoteBranchesForClone()" 
                                    [disabled]="isBusy || isLoadingRemoteBranches || !githubAccessToken" 
                                    class="btn-secondary btn-sm disabled:opacity-50">
                                <span *ngIf="!isLoadingRemoteBranches">Load Branches</span>
                                <span *ngIf="isLoadingRemoteBranches">Loading...</span>
                            </button>
                            <select *ngIf="availableRemoteBranches.length > 0" 
                                    [(ngModel)]="selectedCloneBranch" 
                                    class="flex-1 rounded border border-gray-300 px-3 py-1 text-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500">
                                <option *ngFor="let branch of availableRemoteBranches" [value]="branch">
                                    {{ branch }}
                                </option>
                            </select>
                        </div>
                        <div *ngIf="cloneBranchError" class="mt-2 text-sm text-red-600">{{ cloneBranchError }}</div>
                        <div *ngIf="selectedCloneBranch && availableRemoteBranches.length > 0" class="mt-2 text-xs text-gray-500">
                            Will clone branch: <strong>{{ selectedCloneBranch }}</strong>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="mb-4 flex flex-wrap gap-2" *ngIf="activeRepository">
                        <button type="button" (click)="cloneRepo()" 
                                [disabled]="isBusy || !activeRepository || !githubAccessToken || (!cloneDone && availableRemoteBranches.length === 0)" 
                                class="btn-primary disabled:opacity-50"
                                [title]="!cloneDone && availableRemoteBranches.length === 0 ? 'Load branches first' : ''">
                            {{ cloneDone ? 'Re-Clone' : 'Clone' }}
                        </button>
                        <button type="button" (click)="pullChanges()" [disabled]="isBusy || !cloneDone || !githubAccessToken || !!selectedCommit" class="btn-secondary disabled:opacity-50" [title]="!!selectedCommit ? 'Switch to HEAD view to pull' : (!githubAccessToken ? 'GitHub Token required' : '')">
                            Pull
                        </button>
                        <button type="button" (click)="pushChanges()" [disabled]="isBusy || !cloneDone || !githubAccessToken || !!selectedCommit || selectedFile?.isDirty" class="btn-secondary disabled:opacity-50" [title]="!!selectedCommit ? 'Switch to HEAD view to push' : (selectedFile?.isDirty ? 'Save or discard changes before push' : (!githubAccessToken ? 'GitHub Token required' : 'Push local changes to remote'))">
                            Push
                        </button>                        <button type="button" (click)="getStatus()" [disabled]="isBusy || !cloneDone || !!selectedCommit" class="btn-secondary disabled:opacity-50" [title]="!!selectedCommit ? 'Switch to HEAD view for status' : ''">
                            Status
                        </button>                        <button type="button" (click)="openMergeRequest()" [disabled]="isBusy || !cloneDone || !!selectedCommit" class="btn-primary disabled:opacity-50" [title]="!!selectedCommit ? 'Switch to HEAD view for pull requests' : 'Create pull request'">
                            Pull Request
                        </button>
                    </div>

                    <!-- Branch Management -->
                    <div *ngIf="activeRepository && cloneDone" class="mt-4 pt-4 border-t">
                        <h4 class="text-base font-semibold text-gray-700 mb-2">Branch Management</h4>
                        <div *ngIf="branchError" class="text-red-600 text-sm mb-2">Error: {{ branchError }}</div>

                        <div class="mb-3 text-sm flex items-center justify-between">
                            <div>
                                Current:
                                <span class="font-medium text-indigo-600">{{ currentBranch || 'Detached HEAD' }}</span>
                            </div>
                            <button type="button" (click)="loadBranchData()" [disabled]="isBusy || !cloneDone" class="ml-2 btn-secondary btn-xs disabled:opacity-50">
                                Refresh Branches
                            </button>
                        </div>                        <div class="mb-3 flex items-center gap-2">
                            <label for="branch-select" class="text-sm flex-shrink-0">Switch to:</label>
                            <select id="branch-select"
                                    class="flex-grow rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm disabled:opacity-50 disabled:bg-gray-100"
                                    [disabled]="isBusy || !cloneDone || (localBranches.length === 0 && remoteBranches.length === 0) || !!selectedCommit"
                                    (change)="switchBranch($any($event.target).value)"
                                    #branchSelector
                                    [title]="!!selectedCommit ? 'Switch to HEAD view to change branches' : ''">
                                <option *ngIf="!currentBranch && (localBranches.length > 0 || remoteBranches.length > 0)" value="" disabled selected>Select branch...</option>
                                
                                <!-- Local Branches -->
                                <optgroup *ngIf="localBranches.length > 0" label="Local Branches">
                                    <option *ngFor="let branch of localBranches" [value]="branch" [selected]="branch === currentBranch">
                                        {{ branch }} <span *ngIf="branch === currentBranch">(current)</span>
                                    </option>
                                </optgroup>
                                
                                <!-- Remote Branches -->
                                <optgroup *ngIf="remoteBranches.length > 0" label="Remote Branches">
                                    <option *ngFor="let branch of remoteBranches" [value]="'origin/' + branch">
                                        origin/{{ branch }}
                                    </option>
                                </optgroup>
                                
                                <option *ngIf="localBranches.length === 0 && remoteBranches.length === 0" disabled>No branches available</option>
                            </select>
                        </div>

                        <div class="flex items-center gap-2">
                            <input type="text" placeholder="New branch name..."
                                   [(ngModel)]="newBranchName"
                                   class="flex-grow rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm disabled:opacity-50"
                                   [disabled]="isBusy || !cloneDone || !!selectedCommit"
                                   [title]="!!selectedCommit ? 'Switch to HEAD view to create branches' : ''">
                            <button type="button" (click)="createBranch()"
                                    [disabled]="isBusy || !cloneDone || !newBranchName.trim() || !!selectedCommit"
                                    class="btn-secondary btn-xs disabled:opacity-50 flex-shrink-0"
                                    [title]="!!selectedCommit ? 'Switch to HEAD view to create branches' : ''">
                                Create & Checkout
                            </button>
                        </div>
                        <div *ngIf="isSwitchingBranch || isCreatingBranch" class="text-sm text-blue-600 mt-2 animate-pulse">Processing branch operation...</div>
                    </div>

                </div> <!-- End Git Controls Section -->

                <!-- Commit History Section -->
                 <div *ngIf="activeRepository && cloneDone" class="rounded-lg border border-gray-300 bg-gray-50 p-4 shadow-sm">
                     <div class="flex items-center justify-between mb-3">
                         <h3 class="text-lg font-semibold text-gray-700">
                            Commit History
                            <span *ngIf="isLoadingHistory" class="ml-2 text-sm text-blue-600 animate-pulse">(Loading...)</span>
                         </h3>                         <div>
                            <button type="button" (click)="viewHead()" *ngIf="selectedCommit" [disabled]="isBusy" class="btn-secondary btn-xs mr-2 disabled:opacity-50">
                                View Current (HEAD)
                            </button>
                            <button type="button" (click)="openCommitDiff()" [disabled]="isBusy || !cloneDone" class="btn-secondary btn-xs mr-2 disabled:opacity-50">
                                Compare Commits
                            </button>
                            <button type="button" (click)="loadCommitHistory()" [disabled]="isBusy || !cloneDone" class="btn-secondary btn-xs disabled:opacity-50">
                                Refresh History
                            </button>
                         </div>
                     </div>

                     <div *ngIf="historyError" class="text-red-600 text-sm mb-2 p-2 border border-red-200 bg-red-50 rounded">Error loading history: {{ historyError }}</div>
                     <div *ngIf="!isLoadingHistory && !historyError && commitHistory.length === 0" class="text-sm text-gray-500">No commit history found or loaded yet.</div>

                     <ul *ngIf="commitHistory.length > 0" class="max-h-64 overflow-y-auto space-y-1 text-sm border rounded p-2 bg-white">
                         <li *ngFor="let entry of commitHistory"
                             class="p-1.5 rounded cursor-pointer border-b border-gray-200 last:border-b-0"
                             [class.bg-blue-100]="selectedCommit?.oid === entry.oid"
                             [class.hover:bg-gray-100]="selectedCommit?.oid !== entry.oid"
                             (click)="selectCommit(entry)"
                             [title]="'View files at commit: ' + entry.oid">
                             <div class="flex justify-between items-center mb-0.5">
                                 <span class="font-semibold text-gray-800 truncate pr-2">{{ entry.commit.message.split('\n')[0] }}</span>
                                 <span class="font-mono text-xs text-indigo-600 flex-shrink-0">{{ entry.oid.substring(0, 7) }}</span>
                             </div>
                             <div class="flex justify-between items-center text-xs text-gray-500">
                                 <span>{{ entry.commit.author.name }}</span>
                                 <span [title]="formatTimestamp(entry.commit.author.timestamp)">{{ formatTimestamp(entry.commit.author.timestamp) | date:'short' }}</span>
                             </div>
                         </li>
                     </ul>
                 </div> <!-- End Commit History Section -->


                <!-- File Tree Display Section (Operates on Active Repo / Selected Commit) -->
                <div class="rounded-lg border border-gray-300 bg-white p-4 shadow-sm">
                    <div class="mb-3 flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-700">
                             Repository Files
                             <span *ngIf="activeRepository" class="text-base font-normal text-indigo-600">
                                - {{ activeRepository.name }} ({{ selectedCommit ? selectedCommit.oid.substring(0, 7) : 'HEAD' }})
                             </span>
                             <span *ngIf="isProcessingTree" class="ml-2 text-sm text-blue-600 animate-pulse">(Loading...)</span>
                        </h3>
                        <button type="button" (click)="buildAndDisplayFileTree(selectedCommit ? selectedCommit.oid : 'HEAD')" [disabled]="isBusy || !cloneDone" class="btn-secondary btn-xs disabled:opacity-50">
                             Refresh Tree
                        </button>
                    </div>

                    <div *ngIf="!activeRepository" class="text-sm text-gray-500">Select a managed repository.</div>
                    <div *ngIf="activeRepository && !cloneDone && !isLoading" class="text-sm text-gray-500">Clone the repository to see files.</div>
                    <div *ngIf="activeRepository && cloneDone && isProcessingTree && repositoryTree.length === 0" class="text-sm text-gray-500">Loading file tree...</div>
                    <div *ngIf="activeRepository && cloneDone && !isProcessingTree && repositoryTree.length === 0" class="text-sm text-gray-500">
                        No files found in {{ selectedCommit ? 'selected commit' : 'HEAD' }} or repository seems empty.
                    </div>

                    <div *ngIf="activeRepository && cloneDone && repositoryTree.length > 0" class="max-h-96 overflow-y-auto text-sm">
                        <!-- Recursive template defined below -->
                        <ng-container *ngTemplateOutlet="treeNodeTemplate; context: { nodes: repositoryTree, level: 0 }"></ng-container>
                    </div>                </div> <!-- End File Tree Section -->

                <!-- Merge Request Section -->
                <div *ngIf="activeRepository && cloneDone && showMergeRequest" class="rounded-lg border border-gray-300 bg-white p-4 shadow-sm">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-lg font-semibold text-gray-700">Merge Request</h3>
                        <button type="button" (click)="closeMergeRequest()" class="btn-secondary btn-xs">
                            Close
                        </button>
                    </div>
                    <app-merge-request 
                        [repository]="activeRepository"
                        [fs]="fs"
                        [githubToken]="githubAccessToken"
                        [corsProxy]="corsProxy"
                        (statusUpdate)="addOutput($event)"
                        (mergeCompleted)="onMergeCompleted($event)">
                    </app-merge-request>
                </div>                <!-- Commit Diff Viewer Section -->
                <div *ngIf="activeRepository && cloneDone && showCommitDiff" class="rounded-lg border border-gray-300 bg-white p-4 shadow-sm">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-lg font-semibold text-gray-700">Commit Diff Viewer</h3>
                        <button type="button" (click)="closeCommitDiff()" class="btn-secondary btn-xs">
                            Close
                        </button>
                    </div>
                    <app-commit-diff-viewer 
                        [fs]="fs"
                        [dir]="dir"
                        [commitHistory]="commitHistory">
                    </app-commit-diff-viewer>
                </div>

            </div> <!-- End Left Column -->

            <!-- Right Column: File Content Editor & Output Log -->
            <div class="space-y-6 lg:col-span-2">

                <!-- File Content Editor -->
                <div class="rounded-lg border border-gray-300 bg-white p-4 shadow-sm min-h-[300px] flex flex-col">
                    <div class="flex items-center justify-between mb-3">
                         <h3 class="text-lg font-semibold text-gray-700">File Content</h3>
                         <div class="flex items-center gap-2" *ngIf="selectedFile && !selectedFile.isLoading && !selectedFile.error && !selectedCommit">
                              <button type="button" (click)="saveFileChanges()" [disabled]="!selectedFile?.isDirty || isSavingFile || isBusy" class="btn-primary btn-xs disabled:opacity-50">
                                  <span *ngIf="!isSavingFile">Save & Stage</span>
                                  <span *ngIf="isSavingFile">Saving...</span>
                              </button>
                              <button type="button" (click)="commitChanges()" [disabled]="selectedFile?.isDirty || isSavingFile || isBusy" class="btn-secondary btn-xs disabled:opacity-50" [title]="selectedFile?.isDirty ? 'Save or discard changes first to enable commit' : 'Commit staged changes'">
                                  Commit...
                              </button>
                         </div>
                         <div *ngIf="selectedCommit" class="text-sm text-yellow-700 bg-yellow-100 p-1 px-2 rounded border border-yellow-300">
                            Read-only (Viewing History)
                         </div>
                    </div>

                    <div *ngIf="!activeRepository" class="text-sm text-gray-500">Select a managed repository first.</div>
                    <div *ngIf="activeRepository && !selectedFile && !selectedCommit" class="text-sm text-gray-500">Select a file from the tree (HEAD) to view/edit.</div>
                    <div *ngIf="activeRepository && !selectedFile && selectedCommit" class="text-sm text-gray-500">Select a file from the tree ({{ selectedCommit.oid.substring(0,7) }}) to view.</div>

                    <div *ngIf="selectedFile" class="flex-grow flex flex-col">
                        <div class="mb-2 font-mono text-sm font-semibold text-indigo-700 flex justify-between items-center">
                           <span> {{ selectedFile.path }} </span>
                           <span *ngIf="selectedFile.isDirty && !selectedCommit" class="text-xs font-normal text-orange-600">(modified)</span>
                        </div>
                        <div *ngIf="selectedFile.isLoading" class="loading-indicator text-sm text-blue-600 my-4">Loading content...</div>
                        <div *ngIf="selectedFile.error" class="text-red-600 text-sm p-2 border border-red-300 bg-red-50 rounded my-2">
                           Error: {{ selectedFile.error }}
                        </div>

                        <!-- Codemirror container needs to be flexible -->
                        <div *ngIf="selectedFile.content !== null && !selectedFile.isLoading && !selectedFile.error" class="flex-grow border rounded overflow-hidden min-h-[24rem] relative">
                             <!-- Ensure Codemirror fills its container -->
                             <ngx-codemirror
                                 *ngIf="selectedFile.content !== null"
                                 [(ngModel)]="selectedFile.content"
                                 [options]="cmOptions"
                                 (ngModelChange)="onCodeMirrorChange($event)"
                                 class="absolute inset-0 h-full w-full">
                             </ngx-codemirror>
                        </div>
                         <div *ngIf="selectedFile.content === null && !selectedFile.isLoading && !selectedFile.error" class="text-sm text-gray-500 p-4 bg-gray-50 border rounded">
                             File content is empty or could not be loaded as text (e.g., binary file).
                         </div>
                    </div>
                </div> <!-- End File Content Editor -->

                <!-- Output Log Section -->
                <div class="rounded-lg border border-gray-300 bg-gray-100 p-4 shadow-sm">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-lg font-semibold text-gray-700">Output Log</h3>
                        <button type="button" (click)="clearOutput()" [disabled]="isBusy" class="btn-secondary btn-xs disabled:opacity-50">
                            Clear Log
                        </button>
                    </div>
                    <pre class="h-60 max-h-80 min-h-40 overflow-y-auto rounded bg-white p-3 text-xs font-mono leading-relaxed shadow-inner border border-gray-200 whitespace-pre-wrap break-words">{{ output.length > 0 ? output.join('\n') : 'No output yet.' }}</pre>
                </div> <!-- End Output Log Section -->

            </div> <!-- End Right Column -->

        </div> <!-- End Grid -->
    </div> <!-- End Main Content Area -->
</div> <!-- End Outer Fuse structure -->


<!-- ======================= -->
<!-- Recursive Tree Template -->
<!-- ======================= -->
<ng-template #treeNodeTemplate let-nodes="nodes" let-level="level">
    <ul class="list-none p-0 m-0">
        <li *ngFor="let node of nodes" class="my-0.5">
            <div class="flex items-center cursor-pointer hover:bg-gray-100 rounded p-1 group"
                 [style.padding-left.rem]="level * 1.2"
                 (click)="node.isDirectory ? toggleNodeExpansion(node) : viewFileContent(node)"
                 [class.bg-indigo-50]="selectedFile?.path === node.path && !node.isDirectory"
                 [title]="node.path">
                 <!-- Icon Container -->
                 <div class="flex items-center justify-center w-5 h-5 mr-1 flex-shrink-0">
                    <ng-container *ngIf="node.isDirectory">
                         <!-- Chevron -->
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-400 group-hover:text-blue-600 transition-transform duration-150" [class.rotate-90]="node.expanded" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"> <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" /> </svg>
                         <!-- Folder Icon -->
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-yellow-500 ml-auto" fill="currentColor" viewBox="0 0 20 20"> <path d="M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"></path> </svg>
                    </ng-container>
                    <ng-container *ngIf="!node.isDirectory">
                         <!-- File Icon -->
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-500 ml-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"> <path stroke-linecap="round" stroke-linejoin="round" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" /> </svg>
                    </ng-container>
                 </div>
                <!-- Node Name -->
                <span class="truncate">{{ node.name }}</span>
            </div>
            <!-- Children (Recursive Call) -->
            <div [hidden]="!node.expanded" *ngIf="node.isDirectory && node.children && node.children.length > 0">
                <ng-container *ngTemplateOutlet="treeNodeTemplate; context: { nodes: node.children, level: level + 1 }"></ng-container>
            </div>
             <!-- Empty Directory Indicator -->
             <div *ngIf="node.isDirectory && node.expanded && (!node.children || node.children.length === 0)"
                  class="text-xs text-gray-400"
                  [style.padding-left.rem]="(level + 1) * 1.2 + 0.5">
                 (empty)
             </div>
        </li>
    </ul>
</ng-template>

<!-- Helper CSS -->
<style>
    /* Ensure Codemirror takes full height within its relative parent */
    .CodeMirror { height: 100% !important; font-family: monospace; font-size: 0.875rem; }

    /* Button Styles */
    .btn-primary { 
        display: inline-flex; 
        align-items: center; 
        justify-content: center; 
        border-radius: 0.375rem; 
        border: 1px solid transparent; 
        background-color: #4f46e5; 
        padding: 0.5rem 1rem; 
        font-size: 0.875rem; 
        font-weight: 500; 
        color: white; 
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    }
    .btn-primary:hover { background-color: #4338ca; }
    .btn-primary:disabled { background-color: #a5b4fc; cursor: not-allowed; }
    
    .btn-secondary { 
        display: inline-flex; 
        align-items: center; 
        justify-content: center; 
        border-radius: 0.375rem; 
        border: 1px solid #d1d5db; 
        background-color: white; 
        padding: 0.5rem 1rem; 
        font-size: 0.875rem; 
        font-weight: 500; 
        color: #374151; 
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    }
    .btn-secondary:hover { background-color: #f9fafb; }
    .btn-secondary:disabled { background-color: #f3f4f6; color: #9ca3af; cursor: not-allowed; }
    
    .btn-xs { 
        padding: 0.375rem 0.625rem; 
        font-size: 0.75rem; 
        border-radius: 0.375rem; 
    }

    /* Loading Indicator */
    .loading-indicator { 
        margin: 0.75rem 0; 
        display: flex; 
        align-items: center; 
        font-size: 0.875rem; 
        color: #2563eb; 
    }
    .loading-indicator::before { content: ''; box-sizing: border-box; display: inline-block; width: 1em; height: 1em; margin-right: 0.5em; border: 2px solid currentColor; border-radius: 50%; border-top-color: transparent; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Select padding fix */
    select { padding-top: 0.5rem; padding-bottom: 0.5rem; }

    /* Ensure preformatted text wraps */
    pre {
        white-space: pre-wrap;       /* CSS3 */
        white-space: -moz-pre-wrap;  /* Mozilla, since 1999 */
        white-space: -pre-wrap;      /* Opera 4-6 */
        white-space: -o-pre-wrap;    /* Opera 7 */
        word-wrap: break-word;       /* Internet Explorer 5.5+ */
    }
</style>